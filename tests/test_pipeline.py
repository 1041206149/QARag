"""测试RAG Pipeline完整流程"""import loggingimport sysfrom pathlib import Path# 添加项目根目录到路径sys.path.insert(0, str(Path(__file__).parent.parent))from src.rag_pipeline import RAGPipelinedef test_pipeline():    """测试完整RAG流程"""    logging.basicConfig(        level=logging.INFO,        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'    )    # 1. 初始化Pipeline    print("\n" + "="*50)    print("初始化RAG Pipeline")    print("="*50)    pipeline = RAGPipeline(        top_k=3,        similarity_threshold=0.7,        use_cache=True    )    pipeline.initialize()    # 2. 打印统计信息    print("\n" + "=" * 50)    print("Pipeline统计信息")    print("=" * 50)    stats = pipeline.get_statistics()    data_stats = stats.get('data_stats', {})    if data_stats:        print(f"数据总量: {data_stats.get('total_count', 0)}")        print(f"分类分布: {data_stats.get('categories', {})}")    else:        print("数据统计: 使用缓存索引")    print(f"向量数量: {stats['vector_count']}")    print(f"向量维度: {stats['embedding_dim']}")    print(f"向量化模型: {stats['model_name']}")    print(f"LLM模型: {stats['llm_model']}")    # 3. 测试单个问题    print("\n" + "=" * 50)    print("测试1: 单个问题回答")    print("=" * 50)    test_question = "如何申请退款？"    print(f"\n问题: {test_question}")    result = pipeline.answer(test_question, return_context=True)    print(f"\n答案:\n{result['answer']}")    print(f"\n检索到 {result['retrieved_count']} 个相关文档")    print(f"最高相似度: {result['top_similarity']:.4f}")    if result.get('context'):        print("\n检索到的参考信息:")        for i, doc in enumerate(result['context'], 1):            print(f"\n[{i}] 相似度: {doc['similarity']:.4f}")            print(f"问题: {doc['qa_pair']['question'][:50]}...")            print(f"答案: {doc['qa_pair']['answer'][:50]}...")    # 4. 测试流式输出    print("\n" + "=" * 50)    print("测试2: 流式输出")    print("=" * 50)    test_question_2 = "贷款额度如何提升？"    print(f"\n问题: {test_question_2}")    print("\n答案: ", end="", flush=True)    for chunk in pipeline.answer_stream(test_question_2):        print(chunk, end="", flush=True)    print()    # 5. 测试批量问题    print("\n" + "=" * 50)    print("测试3: 批量问题回答")    print("=" * 50)    test_questions = [        "如何申请退款？",        "贷款审批需要多长时间？",        "会员权益有哪些？"    ]    results = pipeline.batch_answer(test_questions, top_k=2)    for i, result in enumerate(results, 1):        print(f"\n问题{i}: {result['question']}")        print(f"答案: {result['answer'][:100]}...")        print(f"相关文档数: {result.get('retrieved_count', 0)}")        print(f"最高相似度: {result.get('top_similarity', 0):.4f}")    print("\n✅ 所有测试完成！")if __name__ == "__main__":    test_pipeline()